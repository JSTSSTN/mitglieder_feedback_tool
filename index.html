<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ON STAGE Training Center – Feedback</title>

<style>
  body { font-family: Arial, sans-serif; background:#000; color:#fff; margin:0; padding:0; text-align:center; }
  .container { max-width:700px; margin:0 auto; padding:20px; }
  img.logo { width:200px; margin:20px auto; display:block; }
  label, select, button { font-size:18px; }
  select, button { padding:12px; width:100%; margin-top:15px; border:2px solid #fff; background:#111; color:#fff; border-radius:5px; }
  button { cursor:pointer; background:#fff; color:#000; font-weight:bold; }
  button:disabled { opacity:0.5; cursor:not-allowed; }
  .question { font-size:20px; margin-top:40px; margin-bottom:5px; text-align:left; }
  .stars { display:flex; gap:10px; margin-bottom:10px; }
  .star { 
    font-size:36px; cursor:pointer; color:#444; transition:0.2s; 
    display:inline-block; pointer-events:auto; user-select:none;
  }
  .star.selected { color:gold; }
  textarea { width:100%; min-height:50px; background:#111; color:#fff; padding:8px; border-radius:5px; border:2px solid #444; margin-bottom:20px; }
  #submitBtn { margin-top:30px; display:none; }
  #thankYouMessage { 
    display:none; 
    margin-top:40px; 
    padding:30px; 
    background:#1a5f1a; 
    border-radius:10px; 
    font-size:24px; 
    font-weight:bold;
  }
  #errorMessage {
    display:none;
    margin-top:20px;
    padding:20px;
    background:#8b0000;
    border-radius:10px;
    font-size:18px;
  }
</style>
</head>

<body>
<div class="container">

  <img class="logo" src="https://jstsstn.github.io/mitglieder_feedback_tool/Images/logo.png">

  <h2>Feedback – ON STAGE Training Center</h2>

  <label for="location"><b>Bitte Standort auswählen</b></label>
  <select id="location">
    <option value="" disabled selected>Standort wählen</option>
    <option value="Am Felde">Am Felde</option>
    <option value="Krohnskamp">Krohnskamp</option>
    <option value="Conventstraße">Conventstraße</option>
  </select>

  <button id="continueBtn" onclick="startFeedback()">Weiter</button>

  <form id="feedbackForm" style="display:none; margin-top:20px;"></form>

  <button id="submitBtn" onclick="submitFeedback()">Feedback abschicken</button>
  
  <div id="thankYouMessage">
    ✓ Vielen Dank für dein Feedback!
  </div>

  <div id="errorMessage"></div>

</div>

<script>
  const questions = [
    "Wie zufrieden bist du mit dem Kursangebot?",
    "Wie kompetent wirken die Trainer*innen auf dich?",
    "Wie wohl fühlst du dich beim Training?",
    "Wie gut ist die Trainingsfläche ausgestattet?",
    "Wie gefallen dir die Öffnungszeiten?",
    "Wie gut kommst du mit dem Unterrichtstempo klar?",
    "Wie hilfreich ist das Feedback der Trainer*innen?",
    "Wie zufrieden bist du mit den angebotenen Nahrungsergänzungsmitteln?",
    "Wie zufrieden bist du mit der Sauberkeit der Trainingsfläche/Kursräumen?",
    "Wie wahrscheinlich empfiehlst du uns weiter?"
  ];

  const ratingLabels = ["Sehr unzufrieden", "Unzufrieden", "Zufrieden", "Sehr zufrieden"];
  let selectedLocation = "";
  const selectedRatings = {};

  function startFeedback() {
    selectedLocation = document.getElementById("location").value;
    if (!selectedLocation) {
      alert("Bitte Standort auswählen!");
      return;
    }

    document.getElementById("continueBtn").remove();
    document.getElementById("location").disabled = true;

    const form = document.getElementById("feedbackForm");
    form.style.display = "block";
    form.innerHTML = "";

    questions.forEach((questionText, index) => {

      const qDiv = document.createElement("div");
      qDiv.classList.add("question");
      qDiv.textContent = `${index + 1}. ${questionText}`;
      form.appendChild(qDiv);

      const starsDiv = document.createElement("div");
      starsDiv.classList.add("stars");
      starsDiv.id = `stars-${index}`;
      form.appendChild(starsDiv);

      for (let s = 1; s <= 4; s++) {
        const star = document.createElement("span");
        star.classList.add("star");
        star.innerHTML = "★";
        star.addEventListener("click", () => selectStars(index, s));
        starsDiv.appendChild(star);
      }

      const textarea = document.createElement("textarea");
      textarea.id = `comment-${index}`;
      textarea.placeholder = "Dein Kommentar...";
      form.appendChild(textarea);
    });

    document.getElementById("submitBtn").style.display = "inline-block";
  }

  function selectStars(questionIndex, value) {
    selectedRatings[questionIndex] = value;

    const stars = document.querySelectorAll(`#stars-${questionIndex} .star`);
    stars.forEach((star, idx) => {
      star.classList.toggle("selected", idx < value);
    });
  }

  function submitFeedback() {
    for (let i = 0; i < questions.length; i++) {
      if (!selectedRatings[i]) {
        alert(`Bitte Frage ${i + 1} bewerten.`);
        return;
      }
    }

    const submitBtn = document.getElementById("submitBtn");
    submitBtn.disabled = true;
    submitBtn.textContent = "Wird gesendet...";

    const payload = {
      standort: selectedLocation,
      feedback: questions.map((q, i) => ({
        frage: q,
        bewertung: ratingLabels[selectedRatings[i] - 1],
        kommentar: document.getElementById(`comment-${i}`).value.trim()
      }))
    };

    fetch("https://script.google.com/macros/s/AKfycbzpW3zwD6hrSf_wnuo8cqJF2inV0iiMjiW0ubCyY309uf35X_pKVaCaO39FJzIWyoMQXw/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      mode: 'no-cors'
    })
    .then(() => {
      
      document.getElementById("feedbackForm").style.display = "none";
      document.getElementById("submitBtn").style.display = "none";
      document.getElementById("thankYouMessage").style.display = "block";
    })
    .catch(err => {
      console.error(err);
      const errorMsg = document.getElementById("errorMessage");
      errorMsg.textContent = "Verbindungsfehler! Bitte versuche es erneut oder kontaktiere uns.";
      errorMsg.style.display = "block";
      submitBtn.disabled = false;
      submitBtn.textContent = "Feedback abschicken";
    });
  }
</script>

</body>
</html>